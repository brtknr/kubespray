---
- name: delete
  command: rm /etc/kubernetes/inception*
  become: yes
  ignore_errors: yes

- name: download inception files
  get_url:
    url: |
      https://raw.githubusercontent.com/markgoddard/magnum-tools/master/k8s-demo/{{ item }}
    dest: "{{ kube_config_dir }}/{{ item }}"
  with_items: "{{ inception_files }}"
  become: yes

- name: update ip address
  replace:
    path: "{{ kube_config_dir }}/{{ item }}"
    regexp: "10.254.143.3"
    replace: "{{ service_ip }}"
  with_items: "{{ inception_files }}"
  become: yes

- name: apply kubectl service
  command: |
    /opt/bin/kubectl apply -f {{ kube_config_dir }}/{{ item }}
  with_items: "{{ inception_files }}"
...
